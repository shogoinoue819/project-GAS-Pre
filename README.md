# Google Apps Script プロジェクト - 授業シフト管理システム

## 📋 概要

このプロジェクトは、Google Apps Script を使用した授業シフト管理システムです。
スタッフの希望シフトを反映し、自動で講師を割り当てて日次シートに反映する機能を提供します。

## 🏗️ プロジェクト構造

```
project-GAS-Pre/
├── config.js              # アプリケーション定数（Git管理対象）
├── env-config.js          # 環境別設定（Git管理対象外）
├── utils.js               # 共通ユーティリティ関数
├── sheetManager.js        # シート管理機能
├── lessonManager.js       # 講義管理機能
├── wishManager.js         # 希望シフト管理機能
├── teacherAssigner.js     # 講師割り当て機能
├── lessonReflector.js     # 授業反映機能
├── pdfExporter.js         # PDFエクスポート機能
├── createMenu.js          # カスタムメニュー作成
├── switch-env.js          # 環境切り替えスクリプト（Git管理対象外）
├── push-production.sh     # 本番環境デプロイスクリプト
├── push-test.sh          # テスト環境デプロイスクリプト
├── appsscript.json       # Apps Script設定ファイル
├── .clasp.json           # clasp設定ファイル（本番用、Git管理対象外）
├── .clasp-test.json      # clasp設定ファイル（テスト用、Git管理対象外）
└── README.md             # このファイル
```

## 🔧 主要機能

### 1. シート管理機能 (`sheetManager.js`)

- **日次シート作成**: メインシートの日程リストから日次シートを一括生成
- **スタッフシート作成**: メインシートのスタッフリストからスタッフシートを一括生成
- **スタッフ情報反映**: メインシートのスタッフ表示名と背景色を日次シートテンプレートに反映

### 2. 講義管理機能 (`lessonManager.js`)

- **講義情報取得**: 曜日テンプレートシートから講義情報を抽出
- **講義コード解析**: 講義コードから学年・教科情報を取得
- **スタイル情報管理**: セルのスタイル情報を保持・適用

### 3. 希望シフト管理機能 (`wishManager.js`)

- **希望シフト反映**: スタッフ個人シートから希望シフトを日次シートに反映
- **教科担当更新**: スタッフシートの授業可能情報を Priority シートに反映

### 4. 講師割り当て機能 (`teacherAssigner.js`)

- **自動割り当て**: 優先順位と勤務希望を考慮した講師の自動割り当て
- **重複チェック**: 同一コマでの重複割り当てを防止
- **優先度計算**: 学年・教科による講義の優先度計算

### 5. 授業反映機能 (`lessonReflector.js`)

- **全日程反映**: 全日次シートでの講師割り当てを一括実行
- **結果集計**: 割り当て結果の統計情報を表示

### 6. PDF エクスポート機能 (`pdfExporter.js`)

- **一括 PDF 化**: 全日次シートを PDF にエクスポート
- **特定日 PDF 化**: 指定した日付の日次シートを PDF 化
- **Google Drive 保存**: PDF ファイルを指定フォルダに自動保存

## 🚀 セットアップ

### 1. 環境設定

```bash
# テスト環境に切り替え
node switch-env.js test

# 本番環境に切り替え
node switch-env.js production
```

### 2. デプロイ

```bash
# テスト環境にデプロイ
./push-test.sh

# 本番環境にデプロイ
./push-production.sh
```

## 📝 使用方法

### 1. 初期セットアップ

1. **メニューから「日次シート作成」を実行**

   - メインシートの日程リストから日次シートを生成

2. **メニューから「スタッフシート作成」を実行**

   - メインシートのスタッフリストからスタッフシートを生成

3. **メニューから「スタッフ情報反映」を実行**

   - スタッフの表示名と背景色を日次シートテンプレートに反映

### 2. 日常運用

1. **メニューから「希望シフト反映」を実行**

   - スタッフ個人シートの希望シフトを日次シートに反映

2. **メニューから「教科担当更新」を実行**

   - スタッフシートの授業可能情報を Priority シートに反映

3. **メニューから「全日程授業反映」を実行**
   - 全日次シートで講師の自動割り当てを実行

### 3. PDF 出力

1. **メニューから「PDF エクスポート」→「全日次シートを PDF 化」を実行**
   - 全日次シートを PDF にエクスポートして Google Drive に保存

## ⚙️ 設定

### アプリケーション定数 (`config.js`)

```javascript
// シート名
const SHEET_NAMES = {
  MAIN: "Main",
  TEMPLATE_DAILY: "Template_Daily",
  // ...
};

// 行列インデックス
const MAIN_SHEET = {
  DATE: { COL: 1, START_ROW: 4, END_ROW: 10 },
  // ...
};
```

### 環境別設定 (`env-config.js`)

```javascript
// スプレッドシートID
const SPREADSHEET_ID = "your-spreadsheet-id";

// 通常フォルダID
const FOLDER_ID = "your-folder-id";

// PDF保存用フォルダID
const PDF_FOLDER_ID = "your-pdf-folder-id";
```

## 🔒 セキュリティ

### Git 管理対象外ファイル

以下のファイルは機密情報を含むため、Git 管理対象外です：

| ファイル           | 理由                                 |
| ------------------ | ------------------------------------ |
| `env-config.js`    | 環境別 ID が含まれるため             |
| `switch-env.js`    | 環境別 ID が含まれるため             |
| `.clasp.json`      | 本番環境の scriptId が含まれるため   |
| `.clasp-test.json` | テスト環境の scriptId が含まれるため |

### 初回セットアップ

プロジェクトを clone した後、以下のファイルを手動で作成してください：

1. **`env-config.js`**: 環境別設定ファイル
2. **`switch-env.js`**: 環境切り替えスクリプト
3. **`.clasp.json`**: 本番環境用 clasp 設定
4. **`.clasp-test.json`**: テスト環境用 clasp 設定

## 🔍 デバッグ

### ログ確認

Google Apps Script の実行ログで詳細な処理状況を確認できます。

### 環境変数チェック

メニューから「PDF エクスポート」→「環境変数チェック」を実行して設定状況を確認できます。

## 📋 注意事項

1. **環境切り替え**: デプロイ前に適切な環境に切り替えてください
2. **シート構造**: テンプレートシートの構造を変更する場合は定数も更新してください
3. **権限設定**: PDF エクスポート機能には Google Drive への書き込み権限が必要です
4. **セキュリティ**: 機密情報を含むファイルは`.gitignore`で除外されています

## 🤝 貢献

プロジェクトの改善提案やバグ報告は、Issue として報告してください。

## 📄 ライセンス

このプロジェクトは内部使用を目的としています。
